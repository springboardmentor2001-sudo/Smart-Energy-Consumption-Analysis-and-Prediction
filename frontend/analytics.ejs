<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Energy Analytics | EnergyPredict</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            min-height: 100vh;
        }

        header {
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 1.6rem;
            font-weight: 600;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            margin-left: 22px;
            transition: 0.3s;
        }

        nav a:hover {
            color: #00e6e6;
        }

        .analytics-wrapper {
            max-width: 1000px;
            margin: 40px auto;
            padding: 30px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        }

        .analytics-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .analytics-header h2 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .analytics-header p {
            opacity: 0.85;
            font-size: 0.95rem;
        }

        .chart-container {
            position: relative;
            height: 420px;
            width: 100%;
        }

        .no-data {
            text-align: center;
            opacity: 0.85;
            margin-top: 40px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            opacity: 0.7;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 12px;
            }

            .analytics-wrapper {
                margin: 20px;
            }
        }
    </style>
</head>
<body>

<header>
    <h1>⚡ EnergyPredict</h1>
    <nav>
       <a href="/">Home</a>
        <a href="/about">About</a>
        <a href="/predict">Predict</a>
        <a href="/history">History</a>
        <a href="/analytics">Analytics</a>
        <a href="/chatbot">Chatbot</a>
        <a href="/review">Review</a>
    </nav>
</header>

<%
    // SAFE DEFAULTS (prevents crashes)
    const safeLabels = Array.isArray(labels) ? labels : [];
    const safeValues = Array.isArray(values) ? values : [];
    const hasData = safeLabels.length > 0 && safeValues.length > 0;
%>

<div class="analytics-wrapper">
    <div class="analytics-header">
        <h2>Energy Consumption Analytics</h2>
        <p>Visual insights from your past predictions</p>
    </div>

    <% if (!hasData) { %>
        <div class="no-data">
            <p>No analytics data available yet.</p>
            <p>Make predictions to visualize trends here.</p>
        </div>
    <% } else { %>
        <div class="chart-container">
            <canvas id="energyChart"></canvas>
        </div>
    <% } %>
</div>

<footer>
    © <%= new Date().getFullYear() %> EnergyPredict | Data-Driven Energy Insights
</footer>

<% if (hasData) { %>
<script>
    const canvas = document.getElementById('energyChart');

    if (canvas) {
        new Chart(canvas, {
            type: 'line',
            data: {
                labels: <%- JSON.stringify(safeLabels) %>,
                datasets: [{
                    label: 'Predicted Energy Consumption (kWh)',
                    data: <%- JSON.stringify(safeValues) %>,
                    borderColor: '#00e6e6',
                    backgroundColor: 'rgba(0, 230, 230, 0.15)',
                    fill: true,
                    tension: 0.35,
                    pointRadius: 4,
                    pointBackgroundColor: '#00e6e6'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#ffffff'
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#ffffff' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        ticks: { color: '#ffffff' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                }
            }
        });
    }
</script>
<% } %>

</body>
</html>
