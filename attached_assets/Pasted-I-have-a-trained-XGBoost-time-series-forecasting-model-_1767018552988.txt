I have a trained XGBoost time-series forecasting model.
During training, the model used 30 numeric features, including:

Time features: hour_sin, hour_cos, dayofweek, is_weekend

Lag features: energy_lag_1,2,3,6,12,24,48,168

Rolling stats: energy_roll_mean_*, energy_roll_std_*

Behavior probabilities: hvac_on_prob, light_on_prob, expected_occupancy

Weather lag features

At inference time (website ‚Üí backend), the API is passing only ~16 UI-derived features, which causes:

Feature shape mismatch, expected: 30, got: 16
Feature names unseen at fit time
Feature names missing from input

‚ùó ROOT CAUSE (DO NOT IGNORE)

The backend is incorrectly assuming that:

UI inputs = model inputs ‚ùå

But in time-series forecasting:

UI inputs are partial

Most model features must be computed server-side from historical data

‚úÖ REQUIRED FIX (DO THIS EXACTLY)
1Ô∏è‚É£ Load feature schema used during training
feature_names = joblib.load("feature_names.joblib")

2Ô∏è‚É£ Build a complete feature vector on the server

When /forecast is called:

Load recent historical data (same dataset used for training)

Compute all lag, rolling, and probability features

Compute time features from requested timestamp

Do NOT expect the frontend to provide these

3Ô∏è‚É£ Align features STRICTLY

Create the input dataframe like this:

X_forecast = pd.DataFrame(columns=feature_names)

for col in feature_names:
    if col in computed_features:
        X_forecast[col] = [computed_features[col]]
    else:
        X_forecast[col] = [historical_defaults[col]]


‚ö†Ô∏è Never pass extra columns
‚ö†Ô∏è Never change column order

4Ô∏è‚É£ Drop UI-only fields (critical)

Do NOT pass these to the model:

BuildingType
DayOfWeek
Holiday
Hour


These are:

UI display fields

Not used during training

Must be mapped internally instead

5Ô∏è‚É£ Scale using training scaler ONLY
scaler = joblib.load("scaler.joblib")
X_forecast_scaled = scaler.transform(X_forecast)

6Ô∏è‚É£ Predict safely
model = joblib.load("energy_forecast_xgboost.joblib")
prediction = model.predict(X_forecast_scaled)[0]

üö´ WHAT NOT TO DO (IMPORTANT)

‚ùå Do NOT retrain model to ‚Äúmatch frontend‚Äù
‚ùå Do NOT pad with zeros blindly
‚ùå Do NOT remove lag features
‚ùå Do NOT change feature count
‚ùå Do NOT pass raw UI inputs directly to model

‚úÖ FINAL EXPECTED RESULT

/forecast returns 200 OK

No feature mismatch errors

Scaler warning disappears

Prediction matches offline notebook output

Model behaves identically in Kaggle and websit